# Мануал по созданию квартиры в Ignition Gazebo 

Для создания квартиры (комант) именно в Ignition Gazebo понадобятся функции классического Gazebo, а также установленный пакет turtlebot 4 для запуска робота в созданном пространстве. 

## Создание стен квартиры

1. Открыть стандартный Gazebo и выбрать "Edit/Building Editor". Подробный туториал, как работать с этим инструментом здесь: https://classic.gazebosim.org/tutorials?tut=building_editor. Все, что я опишу далее, есть в туториале по ссылке
2. Скачать любой понравившийся план квартиры (так удобнее строить стены)/ можно придумать его самому.
3. Если скачивали план квартиры: с помощью Import во вкладке Building Editor загрузить его и выбрать масштаб в метрах (от этогго зависит размер квартииры в симуляции, лучше не делать слишком большим, так как потом меьедь в ignition будет слишком мелкой)
4. С помощью инструментов Wall, Window и Door сделать стены, окна и двери.
5. Сохранить модель

## Загрузка квартиры в Ignition Gazebo  

После сохранения модель из Gazebo, вы получите два файла: model.sdf и model.config. Для загрузки в Gazebo Ignition потребуется:

1. Создать в этой же папке файл world.sdf со следующим содержанием:

```
<?xml version="1.0" ?>
<sdf version="1.6">
  <world name="default">
    <include>
      <uri>file://{путь до вашего файла model.sdf}</uri> 
    </include>
  </world>
</sdf>
```
Писать путь до файла лучше через /home/ а не через ~/. Пример: /home/user_name/building_editor_models/Untitled/model.sdf

2. Открыть мир в Ignition Gazebo командой:
```
ign gazebo world.sdf 
```
либо
```
ign gazebo -v4 world.sdf
```
Вторая команда будет обеспечивает расширенный вывод сообщений в терминале.

## Заполнение квартиры в Gazebo Ignition

Расставлять мебель можно через интерфейс Gazebo Ignition и через sdf файл, но я советую именно интерфейс, по крайней мере в первый раз!

1. В правом верхнем углу заходим в три точки, там находим плагин "Resourse Spawner", ждем загрузки всех моделей (в моей версии их 1073)
2. **ОБЯЗАТЕЛЬНО** добавляем землю (элемент ground_plane), иначе вся мебель и робот в том чсиле будет падать вниз, не имея опору. Также добавляем свет (модель sun)
3. Через поиск ищем различную мебель, элементы квартиры и так далее, и устанавливаем их в созданной модели стен, задаем правильные коррдинаты и угла поворотов
4. Сохраняем мир: нажимаем в верхнем парвом углу на менюшку, "Save world as", выбираем файл с раширением sdf (лучше выбрать тот же самый файл world.sdf), **ОБЯЗАТЕЛЬНО** тыкаем обе галочки "Expand include tags" и "Save Fuel model version" и сохраняем

## Запуск симуляции с turtlebot 4

1. Переносим созданный мир в папку turtlebot4_simulator/turtlebot4_ignition_bringup/worlds, можно переименовать для удобства
2. Запускаем симуляцию командой

```
ros2 launch turtlebot4_ignition_bringup turtlebot4_ignition.launch.py world:={имя файла} x:={позиция робота по x} y:={позиция робота по y}
```
Может случиться такое, что не будут подгружены текстуры мебели: для устранения этого в файле sdf нужно указать правильный путь для их подкачки. Эти ресурсы хранятся в папке .ignition/fuel/fuel.gazebosim.org/openrobotics/models. 

## Результаты

Моя квратира прикреплена в директории tutorials, название: flat2_world_test.sdf

Пример получившейся квартиры в этой же папке, название: flat_visual.png 

   

